https://github.com/koroed010/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара, получаемая с сервера.
```
interface IApiProduct {
    id: string;
    description?: string;
    image?: string;
    title: string;
    category?: string;
    price: number;
}
```

Массив карточек товаров, получаемый из API
```
interface interface IApiProductsList {
    items: IProduct[];
}
```

Карточка товара. Состоит из данных о товаре, получаемых с сервера, и вспомогательных данных. Содержит исчерпывающий набор данных, необходимых различным элементам приложения.
```
interface IProduct extends IApiProduct {
    inBasket?: boolean;
}
```

Интерфейс для вывода всех карточек, содержащий информацию о карточке, выбранной для просмотра.
```
interface IProductList {
    items: IProduct[];
    showFullCard: string | null;
}
```

Интерфейс для подготовки запросов к серверу на получение или отправку данных.
```
interface IApi {
    baseUrl: string;
    get<T>(uri: string): Promise<T>;
    post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>
}
```

Данные покупателя
```
interface IOrder {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```


#### Сокращенные данные для карточки товара в списке на главной странице.
```
type TProductInfo = Pick<IProduct, 'id' | 'image' | 'title' | 'category' | 'price'>;
```

#### Сокращенные данные для карточки товара в корзине.
```
type TProductBasketInfo = Pick<IProduct, 'id' | 'title' | 'price' >;
```

#### Поля формы для выбора способа оплаты и ввода адреса покупателя.
```
type TOrderPaymentInfo = Pick<IOrder, 'payment' | 'address'>;
```

#### Поля формы для ввода адреса эл. почты и номера телефона покупателя.
```
type TOrderContacttInfo = Pick<IOrder, 'email' | 'phone'>;
```

#### Данные для окна об успешном оформлении заказа.
```
type TOrderSuccessInfo = {total: number};
```

#### Полные данные заказа для отправки на сервер.
```
type TOrderFullInfo = IOrder & {total: number} & {items: string[]};
```


## Архитектура проекта
Приложение построено на базе MVP-архитектуры с использованием слоев данных, представлений и соединяющего их презентера при посредничестве брокера событий.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет сообщать о событиях, происходящих в приложении, и реагировать на них. Класс используется в презентере для обработки событий и в слоях модели и представления для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события,
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component
Абстрактный дженерик родительский класс для классов представления. Реализует общую логику формирования элемента представления.


### Классы моделей данных

В приложении два основных раздела, описывамые соответствующими классами: 
- просмотр предлагаемого ассортимента товаров с возможностью детально ознакомиться с каждым по отдельности, добавить в корзину выбранный товар или удалить его оттуда, если он был добавлен ранее;
- просмотр корзины с возможностью удалить из нее ранее добавленный товар и с переходом к процедуре оформления заказа, предусматривающей получение контактных данных покупателя, с последующей оплатой покупки.

#### Класс ProductsListData (интерфейс IProductList)
Класс предназначен для обеспечения данными основного функционала приложения:
- вывод на страницу карточек товаров,
- выбор карточки для детального просмотра,
- добавить товар в корзину,
- удалить товар из корзины,
- подсчитать общую стоимость товаров в корзине,
- подсчитать общее количество товаров в корзине,
- получать и сохранять данные с помощью методов set и get,
- эмитировать события для обновления списка товаров в корзине, открытия попапа с детальной информацией о товаре, вывода информации об общем количестве товаров в корзине.

Поля класса: массив карточек товаров, id карточки для просмотра, экземпляр брокера событий.\

Конструктор класса принимает экземпляр класса 'EventEmitter'.\

```
    items: IProduct[]; - массив объектов типа карточка,
    showFullCard: string | null; - id краточки для отображения в попапе, тип - string,
    events: IEvents; - экземпляр брокера событий,

    setProductList(); - инициирует массив всех карточек товаров, используя данные API,
    getProductList(): IProduct[]; - возвращает массив всех карточек товаров для главной страницы,
    getBasketProductList(): TProductBasketInfo[]; - возвращает массив карточек товаров для корзины,
    getProductIdList(): string[]; - возвращает массив id карточек товаров в корзине - для формирования данных заказа,
    setShowFullCard(productId: string); - сохраняет id карточки для детального просмотра,
    selectProduct(productId: string): IProduct; - возвращает карточку для детального просмотра,
    clearSelectedProduct(): void; - очищает поле showFullCard при закрытии окна детального просмотра товара,
    updateBasketCounter(): number; - подсчитать общее количество товаров в корзине,
    countBasketTotal(): number | null; - подсчитать общую стоимость товаров в корзине,
    changeProductInBasket(productId: string): void; - добавить товар в корзину, удалить товар из корзины.
```

Генерируемые события:
- 'gallery:saved' - массив карточек сохранен и подготовлен к использованию приложением,
- 'card-preview-id:saved' - сохранен id карточки для детального просмотра,
- 'card-preview:clear' - поле id карточки для детального просмотра очищено,
- 'card-basket:changed' - статус товара - в корзине/нет - изменен.


#### Класс OrderData.
Класс предназначен для хранения и обработки данных покупателя при заполнении форм заказа.\
Имена свойств и их типы данных соответствуют представлению в API.\

Конструктор класса принимает экземпляр класса 'EventEmitter'.\

Действия с оформлением заказа:
- получить и сохранить информацию о покупателе,
- валидировать форму с информацией о покупателе,
- удалить введенные данные покупателя (для очистки формы),
- получать и сохранять данные с помощью методов set и get,
- эмитировать соответствующеие события.

- возвращать данные для отправки заказа на сервер,

```
    payment: string; - выбранный способ оплаты (одна из кнопок формы Order), тип - string,
    address: string; - адрес покупателя из инпута формы Order, тип - string,
    email: string; - email покупателя из инпута формы Contacts, тип - string,
    phone: string; - телефон покупателя из инпута формы Contacts, тип - string,
    protected fullOrder: TOrderFullInfo; - данные для отправки заказа на сервер,
    events: IEvents; - экземпляр брокера событий,

    set setPaymentData(data: string); - получить и сохранить способ оплаты,
    set setAddressData(data: string); - получить и сохранить адрес,
    set setEmailData(data: string); - получить и сохранить email,
    set setPhoneData(data: string); - получить и сохранить телефон,
    checkInput(input: string | null): boolean; - проверка корректного инпута (не пустое поле),
    checkOrder(): boolean; - валидировать форму с информацией - способ оплаты и адрес,
    checkContacts(): boolean; - валидировать форму с информацией - email и телефон,
    get collectOrder(): TOrderFullInfo; - собирает и возвращает данные о покупателе для подготовки отправки заказа на сервер,
    resetOrderInfo(): void; - удаляет введенные данные покупателя из модели (для очистки формы),
```

Генерируемые события:
- 'payment:saved' - информация о способе оплаты сохранена,
- 'address:saved' - адрес сохранен,
- 'contacts:saved' - email или номер телефона сохранен.


### Классы слоя представления
Классы отвечают за отображение получаемых данных в разметке (передачу их в DOM-элементы).

### Класс GalleryView
Класс наследует Component и реализует отображение на главной странице галлереи карточек товаров и иконки корзины с указанием количества товаров в корзине. 

Поля:
- element: HTMLElement; - DOM-элемент - обертка для всей главной страницы,
- events: IEvents; - экземпляр брокера событий,
- headerBasketButton: HTMLButtonElement; - кнопка-иконка корзины,
- basketCounter: HTMLElement; - количество товаров в корзине,

Конструктор класса принимает элемент для размещения в нем галлереи карточек и экземпляр класса 'EventEmitter',
сохраняет в полях класса необходимые DOM-элементы (главная страница, иконка и счетчик корзины), 
устанавливает слушатель на иконку корзины.\

Методы:
- setBasketCounter(data: number); - сеттер для количества товаров в корзине,
- render(prodArray: Partial<IProduct[]> | undefined); - вывод галлереи карточек товаров.

Генерируемые события:
- basket:open - было нажатие на иконку корзины.

#### Класс Modal
Класс наследует Component и реализует единое модальное окно на главной странице, в котором будет реализовываться бОльшая часть функционала приложения. В окне будут выводиться: карточка предпросмотра товаров, корзина, формы ввода данных покупателя, извещение об удачном оформлении заказа.
Методы: открытие, закрытие, в т.ч. Esc, клик по кнопке закрытия или оверлею. Устанавливает соответствующие слушатели событий.\

Поля:
- modal: HTMLElement; - контейнер для размещения содержимого модального окна,

- constructor(selector: string); - конструктор принимает элемент модального окна, 
устанавливает слушатели на Esc, крестик и оверлей с вызывом метода close().

Методы:
- set setElement(element: HTMLElement); - помещает передаваемый элемент в контейнер модального окна,
- deleteElement(); - удаляет элемент из контейнера модального окна,
- openModal(): void; - открывает модальное окно,
- closeModal(): void; - закрывает модальное окно,
- closeByEsc(event: IEvents): void; - вызывает метод close() при нажатии Esc,


#### Класс ProductView
Класс наследует Component.
Отвечает за вывод информации в DOM-элементы:
- карточки товара для вывода в галлерее на главной странице,
- карточки товара для предпросмотра с кнопкой для добавления/удаления товара в корзину,
- карточки товара в корзине с кнопкой удаления товара из корзины.
Сообщает о действиях пользователя:
- выбор карточки товара для предпросмотра,
- нажатие кнопки добавления/удаления товара в корзину.

Поля:
- events: IEvents; - экземпляр класса брокера событий,
- cardButton: HTMLButtonElement; - кнопка добавления/удаления товара в корзину,
- cardCategory: HTMLElement; - категория товара.
- cardImage: HTMLImageElement; - картинка товара,
- cardTitle: HTMLElement; - наименование товара,
- cardDescription: HTMLElement; - подробное описание товара,
- cardPrice: HTMLElement; - цена товара,
- cardId: string; - идентификатор товара,
- cardInBasket: boolean;

- constructor(events: IEvents, protected container: HTMLElement);\
Конструктор класса принимает элемент карточки и экземпляр класса 'EventEmitter',
сохраняет в полях класса необходимые DOM-элементы, устанавливает, в соответствии с видом карточки, 
слушатель на карточку в галлерее или на кнопку добавления/удаления товара в корзину.\

Методы:
- сеттеры для заполнения элементов карточки (в соответствии с видом карточки),
- setCategoryBg(category: string): void; - устанавливает цвет фона для элемента категории товара.

Генерируемые события:
- 'card-preview:chosen' - нажатие на карточку товара в галлерее - выбор карточки для предпросмотра,
- 'card-basket:change' - нажата кнопка добавления/удаления товара в корзину.


#### Класс Basket
Отвечает за вывод информации в DOM-элемент корзины с контейнером для списка товаров и элементом для вывода общей стоимости корзины.
Сообщает о действиях пользователя:
- нажатие кнопки перехода к оформлению заказа.

Поля:
- events: IEvents; - экземпляр класса брокера событий,
- basketList: HTMLElement; - контейнер для списка товаров,
- basketPrice: HTMLElement; - общая стоимость товаров в корзине,
- basketButton: HTMLButtonElement; - кнопка "Оформить",

- constructor(events: IEvents, protected container: HTMLElement);\
Конструктор класса принимает элемент корзины и экземпляр класса 'EventEmitter',
сохраняет в полях класса необходимые DOM-элементы, выполняет донастройку стилей в соответствии с макетом,
устанавливает слушатель на кнопку перехода к оформлению заказа.\

Методы:
- clearBasketList(): void; - удаляет из разметки корзины список товаров,
- set setBasketList(basketItemElement: HTMLElement); - добавляет строку с товаром в разметку корзины,
- get getBasket(): HTMLElement; - возвращает элемент корзины для модального окна,
- render(total: number): HTMLElement;  - отрисовывает корзину.

Генерирует событие:
- 'order:start' - переход из корзины к оформлению заказа (1 этап - способ оплаты и адрес),


#### Класс OrderPaymentView
Создает DOM-элемент с формой для выбора способа оплаты и заполнения поля с адресом.\
Сообщает о заполнении полей формы и передает введенную информацию.\

Поля:
- events: IEvents; - экземпляр класса брокера событий,
- orderButton: HTMLButtonElement; - кнопка "Далее",
- orderCashButton: HTMLButtonElement; - способ оплаты наличными,
- orderCardButton: HTMLButtonElement; - способ оплаты картой,
- orderAddress: HTMLInputElement; - адрес,

- constructor(events: IEvents, protected container: HTMLFormElement)
Конструктор класса принимает элемент с формой и экземпляр класса 'EventEmitter',
сохраняет в полях класса необходимые DOM-элементы, выполняет донастройку стилей в соответствии с макетом,
устанавливает слушатели на поле ввода, кнопки выбора способа оплаты и на кнопку продолжения оформления заказа.\

Методы:
- setPaymentButton(payment: string): void; - выделяет кнопку с выбранной формой оплаты,
- setOrderButton(status: boolean): void; - активирует/дезактивирует кнопку продолжения оформления заказа,
- resetPaymentInfo(): void; - очищает поле ввода, отменяет выделение кнопки способа оплаты и дезактивирует кнопку продолжения оформления заказа,
- render(): HTMLElement; - отрисовывает форму для выбора способа оплаты и заполнения поля с адресом,

Генерирует событие:
- 'payment:input' - нажата кнопка способа оплаты,
- 'address:input' - введен адрес,
- 'order:continue' - продолжение оформления заказа (кнопка "Далее"),


#### Класс OrderContactsView
Создает DOM-элемент с формой для ввода email и номера телефона.\
Сообщает о заполнении полей формы и передает введенную информацию.\

Поля:
- events: IEvents; - экземпляр класса брокера событий,
- contactsButton: HTMLButtonElement; - кнопка "Оплатить",
- orderEmail: HTMLInputElement; - адрес эл. почты,
- orderPhone: HTMLInputElement; - номер телефона,

- constructor(events: IEvents, protected container: HTMLFormElement)
Конструктор класса принимает элемент с формой и экземпляр класса 'EventEmitter',
сохраняет в полях класса необходимые DOM-элементы, выполняет донастройку стилей в соответствии с макетом,
устанавливает слушатели на поля ввода и на кнопку оплаты заказа.\

Методы:
- setContactsButton(status: boolean): void; - активирует/дезактивирует кнопку оплаты заказа,
- resetContactsInfo(): void; - очищает поля ввода и дезактивирует кнопку оплаты заказа,
- render(): HTMLElement; - отрисовывает форму для выбора способа оплаты и заполнения поля с адресом,

Генерирует событие:
- 'email:input' - введен email,
- 'phone:input' - введен номер телефона,
- 'order:fulfilled' - завершение оформления заказа (кнопка "Оплатить"),


#### Класс OrderSuccessView
Создает DOM-элемент с сообщением "Заказ оформлен" и информацией о списанной стоимости покупки.\

Поля:
- events: IEvents; - экземпляр класса брокера событий,
- successButton: HTMLButtonElement; - кнопка "За новыми покупками!",
- basketTotal: HTMLElement; - общая стоимость товаров в корзине,

- constructor(events: IEvents, protected container: HTMLFormElement)
Конструктор класса принимает DOM-элемент и экземпляр класса 'EventEmitter',
сохраняет в полях класса необходимые DOM-элементы, выполняет донастройку стилей в соответствии с макетом,
устанавливает слушатель на кнопку "За новыми покупками!".\

Методы:
- render(): HTMLElement; - отрисовывает элемент с сообщением "Заказ оформлен" и информацией о списанной стоимости покупки,
- set setData(total: number); - сеттер информации о списанной стоимости покупки.

Генерирует событие:
- 'order:finished' - завершение работы с заказом (кнопка "За новыми покупками"),


### Слой коммуникации

#### Класс AppAPI
Класс через конструктор создает экземпляр API с методами для взаимодействия с сервером.\

Поля:
- _baseApi: IApi; - базовые настройки,
- apiProductsList: IApiProductsList; - массив карточек товаров, получаемых с сервера,
- fullOrder: TOrderFullInfo; - информация о заказе, передаваемая на сервер.

- constructor(baseApi: IApi) - конструктор принимает и сохраняет базовые настройки.

Методы:
- getGallery(): Promise<IApiProductsList>; - получает массив карточек товаров с сервера,
- sendOrder(data: TOrderFullInfo): Promise<TOrderFullInfo>; - отправляет заказ на сервер,



## Взаимодействие компонентов

Роль презентера будет выполнять блок кода в файле index.ts, отвечающий за взаимодействие данных из модели и представления.\
С помощью брокера событий в модели и в представлении генерируются события, которые обрабатываются в index.ts.\
В index.ts сначала создаются экземпляры всех необходимых классов, затем описываются методы обработки событий.\


