# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара
```
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
    inBasket: boolean;
    events: IEvents
}
```

Интерфейс для вывода всех карточек
```
interface IProductList {
    total: number;
    items: IProduct[];
    showDetails: string | null;
}
```

Данные покупателя

```
interface IOrder {
    payment: string;
    address: string;
    email: string;
    phone: string;
    items: TProductIdInBasket[];
    paymentValid: boolean;
    contactValid: boolean;
}
```

Корзина

```
interface IBasket {
    total: number | null;
    basketCounter: number;
//    products: TProductInBasket[] | null;
}
```

#### Сокращенные данные для карточки товара в списке на главной странице.

```
type TProductInfo = Pick<IProduct, 'image' | 'title' | 'category' | 'price'>;
```

#### Полные данные для карточки товара в попапе предпросмотра.
```
type TProductFullInfo = Pick<IProduct, 'image' | 'title' | 'category' | 'price' | 'description'>;
```

#### Краткие данные для карточки товара в корзине.
```
type TProductBasketInfo = Pick<IProduct, 'id' | 'title' | 'price'>;
```

#### Поля формы для выбора способа оплаты и ввода адреса покупателя.

```
type TOrderPaymentInfo = Pick<IOrder, 'payment' | 'address'>;
```

#### Поля формы для ввода адреса эл. почты и номера телефона покупателя.

```
type TOrderContacttInfo = Pick<IOrder, 'email' | 'phone'>;
```

#### Данные об общей стоимости произведенной покупки в попапе с подтверждением.

```
type TOrderConfirmInfo = Pick<IBasket, 'total'>;
```


## Архитектура проекта
Приложение построено на базе MVP-архитектуры с использованием слоев данных, представлений и соединяющего их презентера при посредничестве брокера событий.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Классы моделей данных

В приложении два основных раздела, описывамые соответствующими классами: 
- просмотр предлагаемого ассортимента товаров с возможностью детально ознакомиться с каждым по отдельности, добавить в корзину выбранный товар;
- просмотр корзины с возможностью удалить из нее ранее добавленный товар и с переходом к процедуре оформления заказа, предусматривающим получение контактных данных покупателя, с последующей оплатой покупки.

#### Класс ProductData (интерфейс IProduct)
Содержит данные об одном товаре.\
Имена свойств и их типы данных соответствуют представлению в API.\

Действия с карточкой товара: 
- добавить товар в корзину. Добавление однократное, потом можно отключить кнопку,
- получать и сохранять данные с помощью методов set и get,
- эмитировать соответствующее событие.

```
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
    inBasket: boolean;
    events: IEvents;

    sendToBasket(productId: string): TProductInBasket;
```

#### Класс OrderData (интерфейс IOrder)
Содержит данные о товарах данные покпателя.\
Имена свойств и их типы данных соответствуют представлению в API.\
Подписан на событие добавления товара в корзину.\

Действия с оформлением заказа:
- получить и сохранить информацию о добавленном в корзину товаре, ???
- подсчитать общую стоимость товаров в корзине, ???
- получить и сохранить информацию о покупателе,
- валидировать информацию о покупателе,
- передать данные заказа на сервер,
- получить и обработать ответ сервера,
- удалить введенные данные покупателя (для очистки формы),
- получать и сохранять данные с помощью методов set и get,
- эмитировать соответствующее событие.

```
    payment: string;
    address: string;
    email: string;
    phone: string;
    items: TProductIdInBasket[];
    paymentValid: boolean;
    contactValid: boolean;
    events: IEvents;

    getOrderPaymentInfo(data: TOrderPaymentInfo): void;
    getOrderContactInfo(data: TOrderContactInfo): void;
    checkOrderPaymentInfo(data: Record<keyof TOrderPaymentInfo, string>): boolean;
    checkOrderContactInfo(data: Record<keyof TOrderContactInfo, string>): boolean;
    sendOrder(order: IOrder): void;
    resetOrderInfo(order: IOrder): IOrder;
```

#### Класс ProductsListData (интерфейс IProductList)
Отвечает за получение массива карточек с сервера, подготовку полученных данных для отображени на странице,
Действия со списком товаров:
- получить данные с сервера,
- выбрать карточку для детального просмотра,
- получать и сохранять данные с помощью методов set и get,
- эмитировать событие для рендера списка товаров / вывода попапа с детальной информацией о товаре.

```
    total: number;
    items: IProduct[];
    showDetails: string | null;
    events: IEvents; 

    getProductList(): IProduct[];
    selectProduct(productId: string): IProduct;
```

#### BasketData (интерфейс IBasket)
Содержит данные о товарах в корзине.\
Подписан на событие добавления товара в корзину.\

Действия с корзиной:
- получить и сохранить информацию о добавленном в корзину товаре,
- удалить товар из корзины и при необходимости вызвать колбэк,
- подсчитать общую стоимость товаров в корзине,
- подсчитать общее количество товаров в корзине,
- получать и сохранять данные с помощью методов set и get,
- эмитировать соответствующее событие после каждого действия в корзине.

```
    total: number;
    basketCounter: number;
    products: TProductInBasket[] | null;
    events: IEvents;

    updateBasketCounter(products: TProductInBasket[]): number;
    countTotal(products: TProductInBasket[]): number | null;
    addProduct(product: TProductInBasket): void;
    deleteProduct(productId: string, payload: Function | null): void;
```



### Классы слоя представления
Классы отвечают за отображение получаемых данных в разметке (передачу их в DOM-элементы).

#### Класс Modal
Общий класс для всех попапов, имеющий набор стандартных методов:\
открытие, закрытие, в т.ч. Esc, клик по кнопке закрытия или оверлею. Устанавливает соответствующие слушатели событий.\
Содержимое окна и специфический функционал будут определяться передаваемым в конструктор темплейтом и экземпляром класса 'EventEmitter'.\





#### Класс ProductsList
Выводит массив карточек товаров в контейнер главной страницы.\
Конструктор принимает массив карточек и экземпляр класса 'EventEmitter'.\
Позволяет выбрать карточку для детального просмотра в попапе.

Поля класса:
- items: IProduct[];
- showDetails: string | null;
- events: IEvents;


#### Класс BasketCounter
Отвечает за отображение на главной странице количества товаров в корзине.\
Поле:
- basketCounter: number - через конструктор класса получаем данные из модели.

Метод:
- updateCounter(basketCounter: number): viod     - По событию "корзина изменилась" обновляет span.


### Слой коммуникации

#### Класс AppAPI
Класс через конструктор создает экземпляр API с методами для взаимодействия с сервером.\

## Взаимодействие компонентов

Роль презентера будет выполнять блок кода в файле index.ts, отвечающий за взаимодействие данных из модели и представления.\
С помощью брокера событий в данных и в представлении генерируются события, которые обрабатываются в index.ts.\
В index.ts сначала создаются экземпляры всех необходимых классов, затем описываются методы обработки событий.\

Список всех событий, которые могут генерироваться в приложении.\

Список изменений данных, которые необходимо отражать в представлении (генерируются классами модели данных):
- 'basket:canged' - изменение состава корзины,
- 'basket-total:changed' - вычисление общей стоимости товаров в корзине,
- 'basket-amount:changed' - вычисление количества товаров в корзине,
- 'order:save' - сохранение данных о покупателе (1 этап - способ оплаты и адрес),
- 'contacts:save' - сохранение данных о покупателе (2 этап - email и номер телефона),
- 'success' - подтверждение оформления заказа,
- 'card-preview:clear' - очистить данные превью товара при закрытии попапа,
- 'order:clear' - очистка формы первого этапа оформления заказа,
- 'contacts:clear' - очистка формы второго этапа оформления заказа.

Список событий, возникающих при взаимодействии пользователя с интерфейсом (генерируются классами представления):
- 'card-preview:chose' - выбор товара для просмотра,
- 'card-basket:add' - добавление товара в корзину,
- 'basket:open' - переход в корзину,
- 'card-basket:delete' - удаление товара из корзины,
- 'order:start' - переход из корзины к оформлению заказа (1 этап - способ оплаты и адрес),
- 'order:input' - ввод способа оплаты и адреса,
- 'order:continue' - переход ко 2-му этапу оформления заказа (email и номер телефона),
- 'contacts:input' - ввод email и номер телефона,
- 'order:fullfiled' - завершение оформления заказа (кнопка "Оплатить"),
- 'order:finished' - завершение работы с заказом (кнопка "За новыми покупками"),
- 'order:validate' - валидация заполнения формы первого этапа оформления заказа,
- 'contacts:validate' - валидация заполнения формы второго этапа оформления заказа.


